"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.setter=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _db=require("./db");function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}var setter=function setter(client,persist){return function(){var _ref=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(req,res,next){var _iterator,_step,num,message;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!req.body.numbers){_context.next=33;break;}req.body.numbers=JSON.parse(req.body.numbers);_iterator=_createForOfIteratorHelper(req.body.numbers);_context.prev=3;_iterator.s();case 5:if((_step=_iterator.n()).done){_context.next=25;break;}num=_step.value;_context.prev=7;_context.next=10;return client.isRegisteredUser("".concat(num,"@c.us"));case 10:if(_context.sent){_context.next=14;break;}req.unregistered=req.unregistered?[].concat((0,_toConsumableArray2["default"])(req.unregistered),[num]):[num];_context.next=15;break;case 14:req.registered=req.registered?[].concat((0,_toConsumableArray2["default"])(req.registered),[num]):[num];case 15:_context.next=23;break;case 17:_context.prev=17;_context.t0=_context["catch"](7);message="Kesalahan server, coba kirim kembali";(0,_db.setLogCustom)(message);(0,_db.saveError)("client","send-message",_context.t0);return _context.abrupt("return",res.status(500).send(JSON.stringify({status:persist.get("auth"),timestamp:new Date().getTime(),message:message})));case 23:_context.next=5;break;case 25:_context.next=30;break;case 27:_context.prev=27;_context.t1=_context["catch"](3);_iterator.e(_context.t1);case 30:_context.prev=30;_iterator.f();return _context.finish(30);case 33:next();case 34:case"end":return _context.stop();}}},_callee,null,[[3,27,30,33],[7,17]]);}));return function(_x,_x2,_x3){return _ref.apply(this,arguments);};}();};exports.setter=setter;