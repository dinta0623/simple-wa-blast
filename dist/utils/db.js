"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.setLogCustom=exports.setLogUnregistered=exports.setLogRegistered=exports.saveError=exports.setSession=exports.getSession=exports.save=exports.findSingle=exports.find=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _axios=_interopRequireDefault(require("axios"));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){(0,_defineProperty2["default"])(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}require("dotenv").config();var instanceAxios=_axios["default"].create({baseURL:process.env.DB});var find=function(){var _ref=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee(collection,query,type){return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return instanceAxios.get("".concat(type||"get"),{params:{collection:collection,jsonQuery:JSON.stringify(query)}}).then(function(result){return result.data;})["catch"](function(err){return err.message;});case 2:return _context.abrupt("return",_context.sent);case 3:case"end":return _context.stop();}}},_callee);}));return function find(_x,_x2,_x3){return _ref.apply(this,arguments);};}();exports.find=find;var findSingle=function(){var _ref2=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee2(collection,query){return _regenerator["default"].wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return instanceAxios.get(collection,{params:{jsonQuery:JSON.stringify(_objectSpread(_objectSpread({},query),{},{$limit:1}))}}).then(function(result){return result.data;})["catch"](function(err){return err.message;});case 2:return _context2.abrupt("return",_context2.sent);case 3:case"end":return _context2.stop();}}},_callee2);}));return function findSingle(_x4,_x5){return _ref2.apply(this,arguments);};}();exports.findSingle=findSingle;var save=function(){var _ref3=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee3(collection,body,_id){return _regenerator["default"].wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return instanceAxios.put("save",JSON.stringify(_objectSpread({_id:_id},body)),{params:{collection:collection}}).then(function(result){return result.data;})["catch"](function(err){return err.message;});case 2:return _context3.abrupt("return",_context3.sent);case 3:case"end":return _context3.stop();}}},_callee3);}));return function save(_x6,_x7,_x8){return _ref3.apply(this,arguments);};}();exports.save=save;var getSession=function(){var _ref4=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee4(type){return _regenerator["default"].wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return find("wapi",{$limit:1},type);case 2:_context4.next=4;return _context4.sent.result[0];case 4:return _context4.abrupt("return",_context4.sent);case 5:case"end":return _context4.stop();}}},_callee4);}));return function getSession(_x9){return _ref4.apply(this,arguments);};}();exports.getSession=getSession;var setSession=function(){var _ref5=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee5(waBrowserId,waSecretBundle,waToken1,waToken2){var session;return _regenerator["default"].wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return getSession();case 2:session=_context5.sent;_context5.next=5;return save("wapi",{waBrowserId:waBrowserId,waSecretBundle:waSecretBundle,waToken1:waToken1,waToken2:waToken2},session&&session._id);case 5:return _context5.abrupt("return",_context5.sent);case 6:case"end":return _context5.stop();}}},_callee5);}));return function setSession(_x10,_x11,_x12,_x13){return _ref5.apply(this,arguments);};}();exports.setSession=setSession;var saveError=function(){var _ref6=(0,_asyncToGenerator2["default"])(_regenerator["default"].mark(function _callee6(loc,title,err){return _regenerator["default"].wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return save("errors",{state:{on:loc||"",at:err.stack},message:{title:title,detail:err.message}});case 2:return _context6.abrupt("return",_context6.sent);case 3:case"end":return _context6.stop();}}},_callee6);}));return function saveError(_x14,_x15,_x16){return _ref6.apply(this,arguments);};}();exports.saveError=saveError;var setLogCustom=function setLogCustom(message){save("logs",{message:message});};exports.setLogCustom=setLogCustom;var setLogUnregistered=function setLogUnregistered(numbers){numbers&&numbers.forEach(function(num){save("logs",{message:"Gagal mengirim pesan ke nomor ".concat(num,", dikarenakan nomor tersebut tidak terdaftar di whatsapp")});});};exports.setLogUnregistered=setLogUnregistered;var setLogRegistered=function setLogRegistered(numbers){numbers&&numbers.forEach(function(num,i){save("logs",{message:"Pesan berhasil dikirim ke ".concat(num," dan akan diterima dalam ").concat(i*30,"s setelah pesan ini muncul")});});};exports.setLogRegistered=setLogRegistered;